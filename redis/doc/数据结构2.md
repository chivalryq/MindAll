## 第四章 字典

在Redis里，数据库使用字典来作为底层实现。哈希键的底层也是字典（哈希键就是key对应一个对象，对象里有多干键值对）

### 4.1 字典的实现

使用哈希表作为底层实现，一个哈希表包含多个哈希表节点(dictEntry)，每个哈希表节点保存了一个键值对

使用dict.h/dictht结构定义，该结构定义了一个哈希表节点的指针的数组，哈希表长度size，哈希表已用的节点数量used，大小掩码sizemask=size-1.

dictEntry结构体定义了一个键的指针（void* key)，值的联合（可以是一个指针，或者一个有符号或者无符号的64位int，以及指向下一个的指针，解决哈希冲突

字典在dict.h/dict结构中定义，用一个指向dictType结构的指针标志用途不同的字典，每个dictType结构保存了一簇用于操作特定类型键值对的函数。有一个长度为2的dictht哈希表，一般只用第一个元素，第二个的作用是给第一个rehash。此外结构体里话有一个rehashidx记录了当前是不是在rehash

使用MurmurHash2算法计算哈希值，该算法的优点是即使输入的键是有规律的，算法仍能给出一个很好的随机分布性，并且计算速度很快。

渐进式rehash：会同时用两个hash表，避免ht[0]的数量过于庞大，一次rehash直接导致停止服务。每次增删改查的时候rehash，每次对某个key操作的时候，会把这个key里的元素rehash。随着渐进式rehash的过程会把